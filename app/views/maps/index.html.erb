<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content= "width=device-width, initial-scale=1.0">
    
</head>
<style>
    #map {
      height: 100%;
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
</style>
<%= javascript_include_tag 'maps', 'data-turbolinks-track': 'reload' %>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_API_KEY']%>&callback=initMap"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
        var lat;
        var lng;
        geocode();
        function geocode(){ 
        var location = '<%= @location %>'
	    var floors = '<%= @floors %>'
	    var names= '<%= @names %>'
	    var nb_batteries=  '<%= @nb_batteries %>'
	    var nb_elevators =  '<%= @nb_elevators %>'
	    var tech_name =  '<%= @tech_name %>'
        console.log(location);
        console.log(floors);
        console.log(tech_name);

        
        var copie = [];

        for (var i = 0; i < location.length; i++) {
        copie.push(location[i]);
        }
        console.log(copie);


        axios.get("https://maps.googleapis.com/maps/api/geocode/json?&key=<%= ENV['GOOGLE_API_KEY']%>",{
            params:{
                address: location
            }
            
        })
        
        	
		   

        .then(function(response){
            console.log(response);
            var coords = response.data.results[0].geometry.location;
            lat = response.data.results[0].geometry.location.lat;
            lng = response.data.results[0].geometry.location.lng;
            console.log(lat, lng);
            var buildingsComponents = response.data.results[0].buildingsComponents;
            
            

            
        })
        .catch(function(error){
            console.log(error);
        });
        
    }
    function initMap(){
    // Map options
    var options = {
        zoom:8,
        center:{lat:42.3601,lng:-71.0589}
    }

    // New map
    var map = new google.maps.Map(document.getElementById('map'), options);

    // Listen for click on map
    

    /*
    // Add marker
    var marker = new google.maps.Marker({
        position:{lat:42.4668,lng:-70.9495},
        map:map,
        icon:'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png'
    });

    var infoWindow = new google.maps.InfoWindow({
        content:'<h1>Lynn MA</h1>'
    });

    marker.addListener('click', function(){
        infoWindow.open(map, marker);
    });
    */

    // Array of markers
    var markers = [
        {
        coords: {lat: lat , lng: lng} ,
        },
        {
        coords:{lat:42.4668,lng:-70.9495},
        // iconImage:'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png',
        content:'<h1>Lynn MA</h1>'
        },
        {
        coords:{lat:42.8584,lng:-70.9300},
        content:'<h1>Amesbury MA</h1>'
        },
        {
        coords:{lat:42.7762,lng:-71.0773}
        }
    ];

    // Loop through markers
    for(var i = 0;i < markers.length;i++){
        // Add marker
        addMarker(markers[i]);
    }

    // Add Marker Function
    function addMarker(props){
        var marker = new google.maps.Marker({
        position:props.coords,
        map:map
        //icon:props.iconImage
        });

        // Check for customicon
        if(props.iconImage){
        // Set icon image
        marker.setIcon(props.iconImage);
        }

        // Check content
        if(props.content){
        var infoWindow = new google.maps.InfoWindow({
            content:props.content
        });

        marker.addListener('click', function(){
            infoWindow.open(map, marker);
        });
        }
    }
}

</script>
<body>
    
    <div id="map" style="height:800px"></div>
    
</body>
</html>